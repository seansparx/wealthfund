!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("coffeescript",function(a){function b(a){return new RegExp("^(("+a.join(")|(")+"))\\b")}function c(a,b){if(a.sol()){null===b.scope.align&&(b.scope.align=!1);var c=b.scope.offset;if(a.eatSpace()){var f=a.indentation();return f>c&&"coffee"==b.scope.type?"indent":c>f?"dedent":null}c>0&&g(a,b)}if(a.eatSpace())return null;var h=a.peek();if(a.match("####"))return a.skipToEnd(),"comment";if(a.match("###"))return b.tokenize=e,b.tokenize(a,b);if("#"===h)return a.skipToEnd(),"comment";if(a.match(/^-?[0-9\.]/,!1)){var o=!1;if(a.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(o=!0),a.match(/^-?\d+\.\d*/)&&(o=!0),a.match(/^-?\.\d+/)&&(o=!0),o)return"."==a.peek()&&a.backUp(1),"number";var p=!1;if(a.match(/^-?0x[0-9a-f]+/i)&&(p=!0),a.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(p=!0),a.match(/^-?0(?![\dx])/i)&&(p=!0),p)return"number"}if(a.match(r))return b.tokenize=d(a.current(),!1,"string"),b.tokenize(a,b);if(a.match(s)){if("/"!=a.current()||a.match(/^.*\//,!1))return b.tokenize=d(a.current(),!0,"string-2"),b.tokenize(a,b);a.backUp(1)}return a.match(j)||a.match(n)?"operator":a.match(k)?"punctuation":a.match(u)?"atom":a.match(q)?"keyword":a.match(l)?"variable":a.match(m)?"property":(a.next(),i)}function d(b,d,e){return function(f,g){for(;!f.eol();)if(f.eatWhile(/[^'"\/\\]/),f.eat("\\")){if(f.next(),d&&f.eol())return e}else{if(f.match(b))return g.tokenize=c,e;f.eat(/['"\/]/)}return d&&(a.mode.singleLineStringErrors?e=i:g.tokenize=c),e}}function e(a,b){for(;!a.eol();){if(a.eatWhile(/[^#]/),a.match("###")){b.tokenize=c;break}a.eatWhile("#")}return"comment"}function f(b,c,d){d=d||"coffee";for(var e=0,f=!1,g=null,h=c.scope;h;h=h.prev)if("coffee"===h.type||"}"==h.type){e=h.offset+a.indentUnit;break}"coffee"!==d?(f=null,g=b.column()+b.current().length):c.scope.align&&(c.scope.align=!1),c.scope={offset:e,type:d,prev:c.scope,align:f,alignOffset:g}}function g(a,b){if(b.scope.prev){if("coffee"===b.scope.type){for(var c=a.indentation(),d=!1,e=b.scope;e;e=e.prev)if(c===e.offset){d=!0;break}if(!d)return!0;for(;b.scope.prev&&b.scope.offset!==c;)b.scope=b.scope.prev;return!1}return b.scope=b.scope.prev,!1}}function h(a,b){var c=b.tokenize(a,b),d=a.current();if("."===d)return c=b.tokenize(a,b),d=a.current(),/^\.[\w$]+$/.test(d)?"variable":i;"return"===d&&(b.dedent=!0),("->"!==d&&"=>"!==d||b.lambda||a.peek())&&"indent"!==c||f(a,b);var e="[({".indexOf(d);if(-1!==e&&f(a,b,"])}".slice(e,e+1)),o.exec(d)&&f(a,b),"then"==d&&g(a,b),"dedent"===c&&g(a,b))return i;if(e="])}".indexOf(d),-1!==e){for(;"coffee"==b.scope.type&&b.scope.prev;)b.scope=b.scope.prev;b.scope.type==d&&(b.scope=b.scope.prev)}return b.dedent&&a.eol()&&("coffee"==b.scope.type&&b.scope.prev&&(b.scope=b.scope.prev),b.dedent=!1),c}var i="error",j=/^(?:->|=>|\+[+=]?|-[\-=]?|\*[\*=]?|\/[\/=]?|[=!]=|<[><]?=?|>>?=?|%=?|&=?|\|=?|\^=?|\~|!|\?|(or|and|\|\||&&|\?)=)/,k=/^(?:[()\[\]{},:`=;]|\.\.?\.?)/,l=/^[_A-Za-z$][_A-Za-z$0-9]*/,m=/^(@|this\.)[_A-Za-z$][_A-Za-z$0-9]*/,n=b(["and","or","not","is","isnt","in","instanceof","typeof"]),o=["for","while","loop","if","unless","else","switch","try","catch","finally","class"],p=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","@","throw","when","until","extends"],q=b(o.concat(p));o=b(o);var r=/^('{3}|\"{3}|['\"])/,s=/^(\/{3}|\/)/,t=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"],u=b(t),v={startState:function(a){return{tokenize:c,scope:{offset:a||0,type:"coffee",prev:null,align:!1},lastToken:null,lambda:!1,dedent:0}},token:function(a,b){var c=null===b.scope.align&&b.scope;c&&a.sol()&&(c.align=!1);var d=h(a,b);return c&&d&&"comment"!=d&&(c.align=!0),b.lastToken={style:d,content:a.current()},a.eol()&&a.lambda&&(b.lambda=!1),d},indent:function(a,b){if(a.tokenize!=c)return 0;var d=a.scope,e=b&&"])}".indexOf(b.charAt(0))>-1;if(e)for(;"coffee"==d.type&&d.prev;)d=d.prev;var f=e&&d.type===b.charAt(0);return d.align?d.alignOffset-(f?1:0):(f?d.prev:d).offset},lineComment:"#",fold:"indent"};return v}),a.defineMIME("text/x-coffeescript","coffeescript")});