!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("tiddlywiki",function(){function a(a,b,c){return b.tokenize=c,c(a,b)}function b(a,b,c){return k=a,l=c,b}function c(c,k){var l,n=c.sol();if(k.block=!1,l=c.peek(),n&&/[<\/\*{}\-]/.test(l)){if(c.match(x))return k.block=!0,a(c,k,f);if(c.match(s))return b("quote","quote");if(c.match(q)||c.match(r))return b("code","comment");if(c.match(t)||c.match(u)||c.match(v)||c.match(w))return b("code","comment");if(c.match(p))return b("hr","hr")}if(l=c.next(),n&&/[\/\*!#;:>|]/.test(l)){if("!"==l)return c.skipToEnd(),b("header","header");if("*"==l)return c.eatWhile("*"),b("list","comment");if("#"==l)return c.eatWhile("#"),b("list","comment");if(";"==l)return c.eatWhile(";"),b("list","comment");if(":"==l)return c.eatWhile(":"),b("list","comment");if(">"==l)return c.eatWhile(">"),b("quote","quote");if("|"==l)return b("table","header")}if("{"==l&&c.match(/\{\{/))return a(c,k,f);if(/[hf]/i.test(l)&&/[ti]/i.test(c.peek())&&c.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i))return b("link","link");if('"'==l)return b("string","string");if("~"==l)return b("text","brace");if(/[\[\]]/.test(l)&&c.peek()==l)return c.next(),b("brace","brace");if("@"==l)return c.eatWhile(o),b("link","link");if(/\d/.test(l))return c.eatWhile(/\d/),b("number","number");if("/"==l){if(c.eat("%"))return a(c,k,d);if(c.eat("/"))return a(c,k,g)}if("_"==l&&c.eat("_"))return a(c,k,h);if("-"==l&&c.eat("-")){if(" "!=c.peek())return a(c,k,i);if(" "==c.peek())return b("text","brace")}if("'"==l&&c.eat("'"))return a(c,k,e);if("<"!=l)return b(l);if(c.eat("<"))return a(c,k,j);c.eatWhile(/[\w\$_]/);var y=c.current(),z=m.propertyIsEnumerable(y)&&m[y];return z?b(z.type,z.style,y):b("text",null,y)}function d(a,d){for(var e,f=!1;e=a.next();){if("/"==e&&f){d.tokenize=c;break}f="%"==e}return b("comment","comment")}function e(a,d){for(var e,f=!1;e=a.next();){if("'"==e&&f){d.tokenize=c;break}f="'"==e}return b("text","strong")}function f(a,d){var e,f=d.block;return f&&a.current()?b("code","comment"):!f&&a.match(z)?(d.tokenize=c,b("code","comment")):f&&a.sol()&&a.match(y)?(d.tokenize=c,b("code","comment")):(e=a.next(),f?b("code","comment"):b("code","comment"))}function g(a,d){for(var e,f=!1;e=a.next();){if("/"==e&&f){d.tokenize=c;break}f="/"==e}return b("text","em")}function h(a,d){for(var e,f=!1;e=a.next();){if("_"==e&&f){d.tokenize=c;break}f="_"==e}return b("text","underlined")}function i(a,d){for(var e,f=!1;e=a.next();){if("-"==e&&f){d.tokenize=c;break}f="-"==e}return b("text","strikethrough")}function j(a,d){var e,f,g;return"<<"==a.current()?b("brace","macro"):(e=a.next())?">"==e&&">"==a.peek()?(a.next(),d.tokenize=c,b("brace","macro")):(a.eatWhile(/[\w\$_]/),f=a.current(),g=n.propertyIsEnumerable(f)&&n[f],g?b(g.type,g.style,f):b("macro",null,f)):(d.tokenize=c,b(e))}var k,l,m={},n=function(){function a(a){return{type:a,style:"macro"}}return{allTags:a("allTags"),closeAll:a("closeAll"),list:a("list"),newJournal:a("newJournal"),newTiddler:a("newTiddler"),permaview:a("permaview"),saveChanges:a("saveChanges"),search:a("search"),slider:a("slider"),tabs:a("tabs"),tag:a("tag"),tagging:a("tagging"),tags:a("tags"),tiddler:a("tiddler"),timeline:a("timeline"),today:a("today"),version:a("version"),option:a("option"),"with":a("with"),filter:a("filter")}}(),o=/[\w_\-]/i,p=/^\-\-\-\-+$/,q=/^\/\*\*\*$/,r=/^\*\*\*\/$/,s=/^<<<$/,t=/^\/\/\{\{\{$/,u=/^\/\/\}\}\}$/,v=/^<!--\{\{\{-->$/,w=/^<!--\}\}\}-->$/,x=/^\{\{\{$/,y=/^\}\}\}$/,z=/.*?\}\}\}/;return{startState:function(){return{tokenize:c,indented:0,level:0}},token:function(a,b){if(a.eatSpace())return null;var c=b.tokenize(a,b);return c},electricChars:""}}),a.defineMIME("text/x-tiddlywiki","tiddlywiki")});